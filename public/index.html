<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Friends Chat üí¨</title>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0e1525;
      --modal-bg: #1c2333;
      --btn-bg: #2d3548;
      --btn-hover: #3e4451;
      --replit-orange: #F97316;
      --text-main: #F5F9FC;
      --text-dim: #9CA3AF;
    }

    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      overflow: hidden;
    }

    /* --- ANIMATED BACKGROUND --- */
    .bg-gradient {
      position: fixed; inset: 0; z-index: -1;
      background: linear-gradient(45deg, #0e1525, #161e2e, #0e1525);
      background-size: 400% 400%;
      animation: gradientShift 12s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .moving-blob {
      position: absolute; width: 400px; height: 400px;
      background: radial-gradient(circle, rgba(249, 115, 22, 0.08) 0%, transparent 70%);
      filter: blur(50px); border-radius: 50%;
      animation: drift 20s infinite alternate ease-in-out;
      z-index: -1;
    }
    @keyframes drift {
      from { transform: translate(-20%, -20%); }
      to { transform: translate(120%, 100%); }
    }

    /* --- REPLIT LOGIN MODAL --- */
    #login-overlay {
      position: fixed; inset: 0; z-index: 9999;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }

    .login-modal {
      background: var(--modal-bg);
      width: 100%; max-width: 440px;
      padding: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.5);
      text-align: center;
      position: relative;
    }

    .close-x {
      position: absolute; right: 20px; top: 15px;
      color: var(--text-dim); font-size: 20px; cursor: pointer;
    }

    .replit-logo { width: 40px; margin-bottom: 12px; }
    h2 { font-size: 24px; font-weight: 600; margin-bottom: 30px; letter-spacing: -0.02em; }

    .auth-btn {
      width: 100%; padding: 12px; margin-bottom: 12px;
      border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--btn-bg); color: white;
      font-size: 15px; font-weight: 500; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      transition: background 0.2s, transform 0.1s;
    }
    .auth-btn:hover { background: var(--btn-hover); }
    .auth-btn:active { transform: scale(0.98); }
    .auth-btn img { width: 18px; height: 18px; }

    .view-more { color: var(--text-dim); font-size: 14px; margin: 16px 0; cursor: pointer; }
    .view-more:hover { text-decoration: underline; }

    .signup-link { font-size: 14px; color: var(--text-dim); margin-bottom: 24px; }
    .signup-link span { color: var(--replit-orange); cursor: pointer; font-weight: 500; }

    /* Guest Input Area */
    #guest-area { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
    #username-input {
      width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--btn-bg);
      background: var(--bg-dark); color: white; margin-bottom: 15px; box-sizing: border-box; outline: none;
    }
    .join-btn {
      width: 100%; padding: 12px; background: var(--replit-orange);
      border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer;
    }

    .footer-text { font-size: 11px; color: #6B7280; margin-top: 30px; line-height: 1.6; }
    .footer-text a { color: var(--text-dim); text-decoration: underline; }

    /* --- CHAT VIEW --- */
    #chat-app { display: none; flex-direction: column; height: 100vh; }
    .chat-header { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .msg-input-area { padding: 20px; background: var(--modal-bg); display: flex; gap: 10px; }
    .bubble { padding: 10px 15px; border-radius: 12px; background: var(--btn-bg); max-width: 70%; }
    .me { align-self: flex-end; background: #0084ff; }
  </style>
</head>
<body>

  <div class="bg-gradient"></div>
  <div class="moving-blob"></div>

  <div id="login-overlay">
    <div class="login-modal">
      <span class="close-x">‚úï</span>
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/7b/Replit_logo.svg" class="replit-logo" alt="logo">
      <h2>Log in to Friends Chat</h2>
      
      <button class="auth-btn" onclick="showNameInput()">
        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg">
        Continue with Google
      </button>
      
      <button class="auth-btn" onclick="showNameInput()">
        <span>‚úâÔ∏è</span> Continue with Email
      </button>

      <button class="auth-btn" onclick="showNameInput()">
        <span>üîë</span> Use SSO log in
      </button>

      <div class="view-more">View more options</div>

      <div class="signup-link">
        New to Friends Chat? <span onclick="showNameInput()">Create account</span>
      </div>

      <div id="guest-area">
        <input type="text" id="username-input" placeholder="What is your name?" autocomplete="off">
        <button class="join-btn" onclick="enterChat()">Join Chat</button>
      </div>

      <p class="footer-text">
        This site is protected by reCAPTCHA Enterprise and the Google 
        <a href="#">Privacy Policy</a> and <a href="#">Terms of Service</a> apply.
      </p>
    </div>
  </div>

  <div id="chat-app">
    <div class="chat-header">
      <strong>Friends Chat üí¨</strong>
      <span id="user-tag" style="color: var(--text-dim); font-size: 12px;"></span>
    </div>
    <div id="messages"></div>
    <div class="msg-input-area">
      <input id="chat-input" style="flex:1; background:var(--bg-dark); border:1px solid var(--btn-bg); color:white; padding:12px; border-radius:8px; outline:none;" placeholder="Type a message...">
      <button onclick="sendMsg()" style="background:var(--replit-orange); border:none; color:white; padding:0 20px; border-radius:8px; cursor:pointer; font-weight:600;">Send</button>
    </div>
  </div>

<script>
  const socket = io();
  let myName = "";

  function showNameInput() {
    document.getElementById('guest-area').style.display = 'block';
    document.getElementById('username-input').focus();
  }

  function enterChat() {
    const val = document.getElementById('username-input').value.trim();
    if(val) {
      myName = val;
      document.getElementById('login-overlay').style.display = 'none';
      document.getElementById('chat-app').style.display = 'flex';
      document.getElementById('user-tag').innerText = `Logged in as ${myName}`;
      socket.emit('user joined', myName);
    }
  }

  function sendMsg() {
    const input = document.getElementById('chat-input');
    if(input.value) {
      socket.emit('chat message', { user: myName, text: input.value });
      input.value = "";
    }
  }

  socket.on('chat message', (data) => {
    const isMe = data.user === myName;
    const div = document.createElement('div');
    div.style.display = 'flex';
    div.style.flexDirection = 'column';
    if(isMe) div.style.alignItems = 'flex-end';
    
    div.innerHTML = `<div class="bubble ${isMe ? 'me' : ''}"><small style="display:block; opacity:0.6; font-size:10px;">${data.user}</small>${data.text}</div>`;
    document.getElementById('messages').appendChild(div);
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
  });

  socket.on('user status', (msg) => {
    const div = document.createElement('div');
    div.style = "text-align:center; font-size:12px; color:#555; margin:10px 0;";
    div.innerText = msg;
    document.getElementById('messages').appendChild(div);
  });
</script>
</body>
</html>
